<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S-box Cryptographic Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F3F4F6; }
        .sbox-cell { font-size: 0.6rem; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-[1600px] mx-auto px-6 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 text-white p-2 rounded-lg shadow-lg shadow-blue-200">
                    <i class="fas fa-shield-alt fa-lg"></i>
                </div>
                <div>
                    <h1 class="font-bold text-xl text-slate-800 leading-tight">S-box Cryptographic Analyzer</h1>
                    <p class="text-[10px] text-slate-500 font-medium tracking-wide">Ultimate S-box Data | 10 Metrics Analysis</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4 bg-slate-50 p-1.5 rounded-lg border border-slate-200">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-2.5 text-slate-400 text-xs"></i>
                    <input type="text" placeholder="Search 8 boxes..." class="pl-8 pr-4 py-1.5 bg-white border border-slate-200 rounded text-xs w-48 focus:outline-none focus:border-blue-500">
                </div>
                <div class="flex items-center gap-2 px-3 border-l border-slate-200">
                    <i class="fas fa-filter text-slate-400 text-xs"></i>
                    <select class="bg-transparent text-xs font-medium text-slate-600 focus:outline-none">
                        <option>All Categories</option>
                    </select>
                </div>
                <div class="flex items-center gap-2 px-3 border-l border-slate-200">
                    <i class="fas fa-eye text-slate-400 text-xs"></i>
                    <select class="bg-transparent text-xs font-medium text-slate-600 focus:outline-none">
                        <option>Decimal (0-255)</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-2">
                <button class="px-3 py-1.5 bg-blue-50 text-blue-600 text-xs font-bold rounded shadow-sm hover:bg-blue-100">128 S-Boxes</button>
                <button class="px-3 py-1.5 bg-green-50 text-green-600 text-xs font-bold rounded shadow-sm hover:bg-green-100">10 Metrics</button>
                <button class="px-3 py-1.5 bg-indigo-50 text-indigo-600 text-xs font-bold rounded shadow-sm hover:bg-indigo-100">AES-128</button>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto px-6 py-6 grid grid-cols-12 gap-6">
        
        <aside class="col-span-12 xl:col-span-3 space-y-5">
            
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <h3 class="text-xs font-bold text-slate-700 mb-3 flex items-center gap-2">
                    <i class="fas fa-chevron-right text-blue-500"></i> Select S-box Configuration
                </h3>
                <select id="sboxSelect" class="w-full p-2.5 mb-4 text-sm bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-slate-700 font-medium">
                    <option>Loading...</option>
                </select>

                <div class="bg-slate-50 rounded-xl p-4 border border-slate-100 mb-4 relative overflow-hidden">
                    <div class="flex justify-between items-start mb-2 relative z-10">
                        <div>
                            <h2 id="metaName" class="font-bold text-slate-800 text-sm">AES Standard (FIPS 197)</h2>
                            <p class="text-[10px] text-slate-500 mt-0.5">ID: <span id="metaId">AES_STD</span></p>
                        </div>
                        <span id="metaType" class="bg-blue-600 text-white text-[9px] px-2 py-0.5 rounded shadow-sm shadow-blue-200">Standard</span>
                    </div>
                    <p class="text-[10px] text-slate-500 leading-relaxed mb-4 relative z-10">
                        Cryptographic S-box candidate with standard classification metrics.
                    </p>

                    <div class="grid grid-cols-2 gap-2 mb-3 relative z-10">
                        <div class="bg-white p-2 rounded border border-blue-100">
                            <span class="block text-[9px] text-blue-500 font-bold">Matrix Size</span>
                            <span class="block text-xs font-bold text-slate-700">8x8</span>
                        </div>
                        <div class="bg-white p-2 rounded border border-blue-100">
                            <span class="block text-[9px] text-blue-500 font-bold">S-box Size</span>
                            <span class="block text-xs font-bold text-slate-700">256 bytes</span>
                        </div>
                        <div class="bg-white p-2 rounded border border-green-100">
                            <span class="block text-[9px] text-green-600 font-bold">Nonlinearity</span>
                            <span id="cardNL" class="block text-xs font-bold text-slate-700">112</span>
                        </div>
                        <div class="bg-white p-2 rounded border border-green-100">
                            <span class="block text-[9px] text-green-600 font-bold">SAC Score</span>
                            <span id="cardSAC" class="block text-xs font-bold text-slate-700">0.5048</span>
                        </div>
                    </div>

                    <div class="flex items-center gap-2 mb-4 relative z-10">
                        <i class="fas fa-check-circle text-green-500 text-xs"></i>
                        <span class="text-[10px] font-medium text-green-700">Encryption Enabled</span>
                    </div>

                    <div class="grid grid-cols-2 gap-2 relative z-10">
                        <button class="bg-blue-600 hover:bg-blue-700 text-white text-[10px] py-2 rounded-lg font-bold transition flex items-center justify-center gap-2">
                            <i class="fas fa-file-csv"></i> CSV
                        </button>
                        <button class="bg-purple-600 hover:bg-purple-700 text-white text-[10px] py-2 rounded-lg font-bold transition flex items-center justify-center gap-2">
                            <i class="fas fa-code"></i> JSON
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <h3 class="text-xs font-bold text-slate-700 mb-4 flex items-center gap-2">
                    <i class="fas fa-th text-purple-500"></i> Affine Transformation Matrix
                </h3>
                <div class="grid grid-cols-8 gap-1 aspect-square bg-slate-50 p-2 rounded-lg border border-slate-100" id="affineGrid">
                    </div>
                <div class="mt-4 flex justify-between">
                    <div class="bg-slate-50 px-3 py-2 rounded border border-slate-200 w-[48%]">
                        <span class="block text-[9px] text-slate-400 font-bold">Active Bits</span>
                        <span class="block text-sm font-bold text-slate-800">40</span>
                    </div>
                    <div class="bg-slate-50 px-3 py-2 rounded border border-slate-200 w-[48%]">
                        <span class="block text-[9px] text-slate-400 font-bold">Inactive Bits</span>
                        <span class="block text-sm font-bold text-slate-800">24</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-2xl shadow-sm border border-green-200 bg-green-50/30">
                <h3 class="text-[10px] font-bold text-green-700 mb-1 flex items-center gap-1">
                    <i class="fas fa-chart-line"></i> Optimal Performance Candidate
                </h3>
                <p class="font-bold text-sm text-slate-800">Random Candidate #76</p>
                <p class="text-[10px] text-green-600 font-medium">Optimization Score: 0.0021</p>
                <button class="w-full mt-3 bg-green-600 hover:bg-green-700 text-white text-[10px] py-1.5 rounded font-bold">View Analysis</button>
            </div>

        </aside>

        <section class="col-span-12 xl:col-span-9 space-y-6">
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 h-auto md:h-[420px]">
                
                <div class="col-span-12 md:col-span-7 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-sm text-slate-700">Substitution Table Visualization (16x16 Matrix)</h3>
                        <div class="flex items-center gap-2">
                            <span class="text-[9px] text-slate-400 font-bold">Low (0x00)</span>
                            <div class="w-16 h-2 bg-gradient-to-r from-blue-100 to-blue-900 rounded-full"></div>
                            <span class="text-[9px] text-slate-400 font-bold">High (0xFF)</span>
                        </div>
                    </div>
                    
                    <div class="flex mb-1 ml-6">
                        <div class="flex-1 flex text-[9px] text-slate-400 font-bold justify-between px-1">
                            <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            <span>8</span><span>9</span><span>A</span><span>B</span><span>C</span><span>D</span><span>E</span><span>F</span>
                        </div>
                    </div>
                    
                    <div class="flex flex-1">
                        <div class="w-6 flex flex-col justify-between text-[9px] text-slate-400 font-bold py-1">
                            <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            <span>8</span><span>9</span><span>A</span><span>B</span><span>C</span><span>D</span><span>E</span><span>F</span>
                        </div>
                        <div id="sboxGrid" class="flex-1 grid grid-cols-16 grid-rows-16 gap-[1px] bg-slate-200 border border-slate-200 rounded overflow-hidden">
                            </div>
                    </div>
                </div>

                <div class="col-span-12 md:col-span-5 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col">
                    <h3 class="font-bold text-sm text-slate-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-bolt text-yellow-500"></i> Cryptographic Security Metrics Distribution
                    </h3>
                    <div class="flex-1 relative flex items-center justify-center">
                        <canvas id="radarChart"></canvas>
                    </div>
                    <p class="text-[10px] text-slate-400 text-center mt-2 italic">Higher values indicate better performance across cryptographic properties</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <div class="flex items-center gap-2 mb-6">
                    <div class="bg-green-100 p-1.5 rounded text-green-600"><i class="fas fa-chart-bar"></i></div>
                    <h3 class="font-bold text-base text-slate-800">Comprehensive Metrics Evaluation</h3>
                </div>

                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-6 text-[10px] text-slate-500 grid grid-cols-2 gap-x-8 gap-y-1">
                    <p><span class="font-bold text-slate-700">NL (Nonlinearity):</span> Resistance to linear cryptanalysis (Higher is better, target 112)</p>
                    <p><span class="font-bold text-slate-700">SAC (Strict Avalanche):</span> Output change probability per input bit flip (Target 0.5)</p>
                    <p><span class="font-bold text-slate-700">BIC-NL:</span> Bit Independence nonlinearity measure</p>
                    <p><span class="font-bold text-slate-700">BIC-SAC:</span> Bit Independence avalanche criterion</p>
                    <p><span class="font-bold text-slate-700">LAP (Linear Approx):</span> Maximum linear approximation probability (Lower is better)</p>
                    <p><span class="font-bold text-slate-700">DAP (Differential Approx):</span> Maximum differential probability (Lower is better)</p>
                    <p><span class="font-bold text-slate-700">DU (Diff. Uniformity):</span> Differential characteristic resistance (Lower is better)</p>
                    <p><span class="font-bold text-slate-700">AD (Algebraic Degree):</span> Complexity of boolean function (Target 7)</p>
                    <p><span class="font-bold text-slate-700">TO (Transparency Order):</span> Resistance to interpolation attacks</p>
                    <p><span class="font-bold text-slate-700">CI (Correlation Immunity):</span> Independence from linear combinations (Target > 0)</p>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8" id="metricsGrid">
                    </div>

                <div class="h-64 w-full">
                    <canvas id="barChart"></canvas>
                </div>
                <div class="flex justify-center gap-4 mt-4 text-[10px] font-medium text-slate-500">
                    <span class="flex items-center gap-1"><div class="w-2 h-2 bg-blue-500 rounded-full"></div> AES Standard (FIPS 197)</span>
                    <span class="flex items-center gap-1"><div class="w-2 h-2 bg-purple-500 rounded-full"></div> K1 (Paper Candidate)</span>
                    <span class="flex items-center gap-1"><div class="w-2 h-2 bg-pink-500 rounded-full"></div> K2 (Paper Candidate)</span>
                    <span class="flex items-center gap-1"><div class="w-2 h-2 bg-yellow-500 rounded-full"></div> K3 (Paper Candidate)</span>
                </div>
                <p class="text-center text-[9px] text-slate-400 mt-2">Comparative analysis of primary cryptographic strength indicators across 5 box candidates</p>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <div class="flex items-center gap-2 mb-4">
                    <i class="fas fa-lock text-indigo-600"></i>
                    <h3 class="font-bold text-base text-slate-800">Text Encryption & Decryption Module</h3>
                </div>

                <div class="bg-indigo-50 border border-indigo-100 rounded-lg p-3 flex items-start gap-3 mb-6">
                    <i class="fas fa-info-circle text-indigo-500 mt-0.5"></i>
                    <p class="text-[10px] text-indigo-800">
                        <span class="font-bold">Encryption Module Active</span><br>
                        This feature is available for <span class="font-bold">AES Standard</span> and <span class="font-bold">K44 Optimized</span> S-boxes only. The encryption uses XOR key mixing with S-box substitution.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <div class="flex bg-slate-100 rounded-lg p-1">
                            <button id="btnModeEncrypt" onclick="setMode('encrypt')" class="flex-1 py-1.5 rounded-md text-xs font-bold text-white bg-green-600 shadow-sm transition"><i class="fas fa-lock text-[10px] mr-1"></i> Encrypt</button>
                            <button id="btnModeDecrypt" onclick="setMode('decrypt')" class="flex-1 py-1.5 rounded-md text-xs font-bold text-slate-500 hover:text-slate-700 transition"><i class="fas fa-unlock text-[10px] mr-1"></i> Decrypt</button>
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-600 mb-1"><i class="fas fa-key mr-1"></i> Secret Key (Minimum 4 chars)</label>
                            <input type="text" id="textKey" placeholder="Enter your encryption key..." class="w-full p-2.5 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:border-indigo-500 outline-none">
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-600 mb-1">Plaintext Input</label>
                            <textarea id="textInput" rows="4" placeholder="Enter your message to encrypt..." class="w-full p-2.5 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:border-indigo-500 outline-none font-mono"></textarea>
                            <div class="text-right text-[9px] text-slate-400 mt-1">Character count: <span id="charCount">0</span></div>
                        </div>

                        <button onclick="processText()" class="w-full bg-slate-500 hover:bg-slate-600 text-white text-xs font-bold py-2.5 rounded-lg shadow-sm transition flex items-center justify-center gap-2">
                            <i class="fas fa-sync-alt"></i> Process Message
                        </button>
                    </div>

                    <div class="flex flex-col h-full">
                        <label class="block text-[10px] font-bold text-slate-600 mb-1">Encrypted Output (Hex/Base64)</label>
                        <div id="textResult" class="flex-1 bg-green-50 border border-green-100 rounded-lg p-3 text-xs font-mono text-green-800 break-all overflow-y-auto max-h-[180px]">
                            Encrypted text will appear here...
                        </div>
                        
                        <div class="mt-4 bg-blue-50 border border-blue-100 rounded-lg p-3">
                            <h4 class="text-[10px] font-bold text-blue-700 mb-1"><i class="fas fa-cog mr-1"></i> Encryption Algorithm Overview</h4>
                            <ul class="text-[9px] text-blue-600 space-y-1 list-disc pl-3">
                                <li>Step 1: Input text is converted to byte array</li>
                                <li>Step 2: XOR operation with repeating key pattern</li>
                                <li>Step 3: S-box Substitution for non-linearity</li>
                                <li>Step 4: Base64/Hex encoding for safe transmission</li>
                            </ul>
                        </div>

                        <div class="mt-2 flex justify-between items-center p-2 bg-white border border-slate-200 rounded-lg">
                            <div>
                                <span class="block text-[9px] text-slate-400 font-bold">Active S-box Configuration</span>
                                <span id="activeSboxName" class="block text-[10px] font-bold text-slate-700">AES Standard (FIPS 197)</span>
                            </div>
                            <span class="bg-indigo-600 text-white text-[8px] px-2 py-1 rounded font-bold">Industry Standard</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-orange-50 border border-orange-100 rounded-xl p-4 flex justify-between items-center">
                <div>
                    <h4 class="text-xs font-bold text-orange-800 mb-1"><i class="fas fa-bolt mr-1"></i> Quick Start Example</h4>
                    <div class="flex gap-4 mt-2">
                        <div class="bg-white px-2 py-1 rounded border border-orange-100">
                            <span class="text-[8px] text-slate-400 block">Step 1: Enter Key</span>
                            <span class="text-[10px] font-mono font-bold text-slate-700">CryptoKey2024</span>
                        </div>
                        <div class="bg-white px-2 py-1 rounded border border-orange-100">
                            <span class="text-[8px] text-slate-400 block">Step 2: Enter Text</span>
                            <span class="text-[10px] font-mono font-bold text-slate-700">Secret Message</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white px-3 py-2 rounded border border-orange-100">
                    <span class="text-[8px] text-slate-400 block">Step 3: Result</span>
                    <span class="text-[10px] font-mono font-bold text-orange-600">7A 4B 1C ...</span>
                </div>
            </div>

        </section>
    </main>

    <footer class="max-w-[1600px] mx-auto px-6 py-8 flex justify-between items-center text-[10px] text-slate-400 border-t border-slate-200 mt-6">
        <p>S-box Cryptographic Analyzer Â© 2024</p>
        <p>Generated: 2025-12-22 17:53:24<br>Academic Research Tool</p>
    </footer>

    <script>
        let sboxData = [];
        let currentSboxId = "AES_STD";
        let cryptoMode = 'encrypt';
        let radarChartInstance = null;
        let barChartInstance = null;

        // --- MOCKUP DATA FOR AFFINE MATRIX (Visual Only) ---
        const affinePattern = [
            1,0,0,0,1,1,1,1,
            1,1,0,0,0,1,1,1,
            1,1,1,0,0,0,1,1,
            1,1,1,1,0,0,0,1,
            1,1,1,1,1,0,0,0,
            0,1,1,1,1,1,0,0,
            0,0,1,1,1,1,1,0,
            0,0,0,1,1,1,1,1
        ];

        // --- INIT ---
        async function init() {
            try {
                const response = await fetch('/api/data');
                const data = await response.json();
                sboxData = data.candidates;
                
                populateDropdown();
                renderAffineGrid();
                updateDashboard(currentSboxId);
            } catch (error) {
                console.error("Error loading data:", error);
                document.getElementById('metaName').innerText = "Error loading backend data";
            }
        }

        // --- RENDER FUNCTIONS ---

        function populateDropdown() {
            const select = document.getElementById('sboxSelect');
            select.innerHTML = '';
            sboxData.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.innerText = item.name;
                select.appendChild(opt);
            });
            select.addEventListener('change', (e) => updateDashboard(e.target.value));
        }

        function renderAffineGrid() {
            const grid = document.getElementById('affineGrid');
            grid.innerHTML = '';
            affinePattern.forEach(val => {
                const div = document.createElement('div');
                div.className = `rounded-sm flex items-center justify-center text-[6px] font-bold ${val ? 'bg-indigo-700 text-white' : 'bg-white text-slate-300'}`;
                div.innerText = val;
                grid.appendChild(div);
            });
        }

        async function updateDashboard(id) {
            currentSboxId = id;
            const candidate = sboxData.find(x => x.id === id);
            if (!candidate) return;

            // Metadata Updates
            document.getElementById('metaName').innerText = candidate.name;
            document.getElementById('metaId').innerText = candidate.id;
            document.getElementById('activeSboxName').innerText = candidate.name;
            document.getElementById('metaType').innerText = candidate.type.toUpperCase();
            
            // Side Card Values
            document.getElementById('cardNL').innerText = candidate.metrics.NL;
            document.getElementById('cardSAC').innerText = candidate.metrics.SAC.toFixed(4);

            // Render Grids & Charts
            renderMetricsCards(candidate.metrics);
            updateCharts(candidate);
            
            // Fetch S-box Values for Grid
            try {
                const res = await fetch(`/api/sbox-values/${id}`);
                const data = await res.json();
                renderSboxGrid(data.sbox);
            } catch(e) { console.error(e); }
        }

        function renderSboxGrid(values) {
            const grid = document.getElementById('sboxGrid');
            grid.innerHTML = '';
            values.forEach(val => {
                const div = document.createElement('div');
                // Calculate color intensity (Blue scale)
                const opacity = 0.1 + (val / 255) * 0.9;
                const bgColor = `rgba(59, 130, 246, ${opacity})`; // Blue-500 base
                const textColor = val > 128 ? 'white' : '#1e293b'; // Slate-800

                div.className = 'flex items-center justify-center text-[7px] font-mono cursor-default hover:border hover:border-yellow-400 transition-colors';
                div.style.backgroundColor = bgColor;
                div.style.color = textColor;
                div.innerText = val.toString(16).toUpperCase().padStart(2, '0');
                div.title = `Dec: ${val} | Hex: ${div.innerText}`;
                grid.appendChild(div);
            });
        }

        function renderMetricsCards(m) {
            const container = document.getElementById('metricsGrid');
            container.innerHTML = '';

            const metricsDef = [
                { k: 'NL', label: 'NONLINEARITY', target: 'Target: 112', icon: 'fa-shield-alt', color: 'text-purple-600', bg: 'bg-purple-100' },
                { k: 'SAC', label: 'SAC', target: 'Target: 0.5', icon: 'fa-bolt', color: 'text-blue-600', bg: 'bg-blue-100' },
                { k: 'BIC_NL', label: 'BIC-NL', target: 'Target: 112', icon: 'fa-cube', color: 'text-green-600', bg: 'bg-green-100' },
                { k: 'BIC_SAC', label: 'BIC-SAC', target: 'Target: 0.5', icon: 'fa-chart-area', color: 'text-orange-600', bg: 'bg-orange-100' },
                { k: 'LAP', label: 'LAP', target: 'Target: 0.0625', icon: 'fa-balance-scale', color: 'text-pink-600', bg: 'bg-pink-100' },
                { k: 'DAP', label: 'DAP', target: 'Target: 0.015625', icon: 'fa-compress-arrows-alt', color: 'text-indigo-600', bg: 'bg-indigo-100' },
                { k: 'DU', label: 'DIFF. UNIFORMITY', target: 'Target: 4', icon: 'fa-code-branch', color: 'text-blue-600', bg: 'bg-blue-100' },
                { k: 'AD', label: 'ALGEBRAIC DEG.', target: 'Target: 7', icon: 'fa-superscript', color: 'text-purple-600', bg: 'bg-purple-100' },
                { k: 'TO', label: 'TRANSPARENCY', target: 'Target: 0', icon: 'fa-eye', color: 'text-teal-600', bg: 'bg-teal-100' },
                { k: 'CI', label: 'CORR. IMMUNITY', target: 'Target: >0', icon: 'fa-link', color: 'text-emerald-600', bg: 'bg-emerald-100' }
            ];

            metricsDef.forEach(def => {
                let val = m[def.k];
                if(typeof val === 'number' && val % 1 !== 0) val = val.toFixed(6);
                
                const html = `
                    <div class="bg-white p-3 rounded-xl border border-slate-100 hover:shadow-md transition">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="${def.bg} p-1.5 rounded-full ${def.color}"><i class="fas ${def.icon} text-xs"></i></div>
                            <span class="text-[9px] font-bold text-slate-500 uppercase">${def.label}</span>
                        </div>
                        <div class="text-lg font-bold text-slate-800 leading-none mb-1">${val}</div>
                        <div class="w-full bg-slate-100 h-1 rounded-full mb-1">
                            <div class="h-1 rounded-full ${def.color.replace('text-', 'bg-')}" style="width: 75%"></div>
                        </div>
                        <div class="text-[8px] text-slate-400 font-medium">${def.target}</div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // --- CHARTS ---
        function updateCharts(candidate) {
            const m = candidate.metrics;
            
            // RADAR CHART
            const radarCtx = document.getElementById('radarChart').getContext('2d');
            const radarData = [m.NL/112, m.SAC*2, m.BIC_NL/112, m.BIC_SAC*2, 1-(m.LAP*4), 1-(m.DAP*10)]; // Normalized rough values
            
            if(radarChartInstance) radarChartInstance.destroy();
            radarChartInstance = new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: ['NL', 'SAC', 'BIC-NL', 'BIC-SAC', 'LAP', 'DAP'],
                    datasets: [{
                        label: 'Metric Distribution',
                        data: radarData,
                        backgroundColor: 'rgba(99, 102, 241, 0.4)', // Indigo-500 with opacity
                        borderColor: '#6366f1',
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#6366f1',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#e2e8f0' },
                            pointLabels: { font: { size: 9, family: 'Inter' }, color: '#64748b' },
                            ticks: { display: false, max: 1 }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // BAR CHART
            const barCtx = document.getElementById('barChart').getContext('2d');
            if(barChartInstance) barChartInstance.destroy();
            
            // Dummy comparison data for visual match
            barChartInstance = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['NL', 'SAC', 'BIC-NL', 'BIC-SAC', 'LAP'],
                    datasets: [
                        { label: 'AES', data: [112, 0.50, 112, 0.50, 0.06], backgroundColor: '#3b82f6', borderRadius: 4 },
                        { label: 'K1', data: [112, 0.50, 112, 0.50, 0.12], backgroundColor: '#a855f7', borderRadius: 4 },
                        { label: 'K2', data: [112, 0.50, 112, 0.50, 0.12], backgroundColor: '#ec4899', borderRadius: 4 },
                        { label: 'K3', data: [112, 0.50, 112, 0.50, 0.12], backgroundColor: '#eab308', borderRadius: 4 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f1f5f9' }, ticks: { font: {size: 9} } },
                        x: { grid: { display: false }, ticks: { font: {size: 9} } }
                    }
                }
            });
        }

        // --- ENCRYPTION LOGIC ---
        function setMode(mode) {
            cryptoMode = mode;
            const btnEnc = document.getElementById('btnModeEncrypt');
            const btnDec = document.getElementById('btnModeDecrypt');
            
            if(mode === 'encrypt') {
                btnEnc.className = "flex-1 py-1.5 rounded-md text-xs font-bold text-white bg-green-600 shadow-sm transition";
                btnDec.className = "flex-1 py-1.5 rounded-md text-xs font-bold text-slate-500 hover:text-slate-700 transition";
            } else {
                btnEnc.className = "flex-1 py-1.5 rounded-md text-xs font-bold text-slate-500 hover:text-slate-700 transition";
                btnDec.className = "flex-1 py-1.5 rounded-md text-xs font-bold text-white bg-orange-500 shadow-sm transition";
            }
        }

        document.getElementById('textInput').addEventListener('input', function(e) {
            document.getElementById('charCount').innerText = e.target.value.length;
        });

        async function processText() {
            const text = document.getElementById('textInput').value;
            const key = document.getElementById('textKey').value;
            const resultBox = document.getElementById('textResult');

            if(!text || !key) {
                alert("Please enter both text and a secret key.");
                return;
            }

            resultBox.innerText = "Processing...";
            const endpoint = cryptoMode === 'encrypt' ? '/api/encrypt-text' : '/api/decrypt-text';

            try {
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ text, key, sbox_id: currentSboxId })
                });
                const data = await res.json();
                
                if(data.error) {
                    resultBox.innerText = "Error: " + data.error;
                    resultBox.classList.add('text-red-600');
                } else {
                    resultBox.innerText = data.result;
                    resultBox.classList.remove('text-red-600');
                }
            } catch(e) {
                resultBox.innerText = "Network Error";
            }
        }

        // Run
        init();
    </script>
</body>
</html>

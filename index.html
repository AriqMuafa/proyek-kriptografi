<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S-Box Cryptographic Analyzer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide-static/0.321.0/lucide.min.css" rel="stylesheet">
    <style>
        body { background: radial-gradient(circle at top, #1e1b4b, #0f172a); min-height: 100vh; color: white; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #a855f7; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, ResponsiveContainer, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend } = Recharts;

        const SboxAnalyzer = () => {
            const [data, setData] = useState({ candidates: [] });
            const [selectedCandidate, setSelectedCandidate] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [sortBy, setSortBy] = useState('NL');

            // 1. AMBIL DATA DARI API PYTHON
            useEffect(() => {
                fetch('/api/data')
                    .then(res => res.json())
                    .then(json => {
                        setData(json);
                        if (json.candidates.length > 0) setSelectedCandidate(json.candidates[0]);
                    });
            }, []);

            // Logika perhitungan skor (tetap menggunakan rumus Anda)
            const calculateSecurityScore = (metrics) => {
                const weights = { NL: 1, SAC: 1, LAP: 1, DAP: 1 }; // Contoh simplifikasi
                return Math.round((metrics.NL / 128) * 100); 
            };

            const filteredCandidates = useMemo(() => {
                return data.candidates
                    .filter(c => c.name.toLowerCase().includes(searchTerm.toLowerCase()))
                    .sort((a, b) => b.metrics[sortBy] - a.metrics[sortBy]);
            }, [data.candidates, searchTerm, sortBy]);

            const radarData = useMemo(() => {
                if (!selectedCandidate) return [];
                const m = selectedCandidate.metrics;
                return [
                    { subject: 'NL', A: m.NL, fullMark: 128 },
                    { subject: 'SAC', A: m.SAC * 200, fullMark: 100 },
                    { subject: 'LAP', A: (1 - m.LAP) * 100, fullMark: 100 },
                    { subject: 'DAP', A: (1 - m.DAP) * 100, fullMark: 100 },
                    { subject: 'DU', A: (1 - (m.DU/10)) * 100, fullMark: 100 }
                ];
            }, [selectedCandidate]);

            return (
                <div className="p-6 max-w-7xl mx-auto">
                    <header className="mb-10 text-center">
                        <h1 className="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">
                            S-Box Cryptographic Analyzer
                        </h1>
                        <p className="text-slate-400">Advanced Visualization for AES Candidates</p>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        {/* Sidebar: List Kandidat */}
                        <div className="bg-slate-800/50 p-4 rounded-2xl border border-slate-700">
                            <input 
                                type="text" 
                                placeholder="Cari kandidat..." 
                                className="w-full bg-slate-900 border border-slate-700 p-2 rounded-lg mb-4 text-white"
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <div className="h-[600px] overflow-y-auto custom-scrollbar space-y-2">
                                {filteredCandidates.map(c => (
                                    <div 
                                        key={c.id}
                                        onClick={() => setSelectedCandidate(c)}
                                        className={`p-4 rounded-xl cursor-pointer transition ${selectedCandidate?.id === c.id ? 'bg-purple-600 border-purple-400' : 'bg-slate-900/50 hover:bg-slate-700'}`}
                                    >
                                        <div className="font-bold">{c.id}</div>
                                        <div className="text-xs opacity-60">NL: {c.metrics.NL} | SAC: {c.metrics.SAC.toFixed(3)}</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Main: Visualisasi */}
                        <div className="lg:col-span-2 space-y-6">
                            {selectedCandidate && (
                                <div className="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                                    <h2 className="text-2xl font-bold mb-4">{selectedCandidate.name}</h2>
                                    <div className="h-[400px]">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <RadarChart cx="50%" cy="50%" outerRadius="80%" data={radarData}>
                                                <PolarGrid stroke="#475569" />
                                                <PolarAngleAxis dataKey="subject" tick={{fill: '#94a3b8'}} />
                                                <Radar name="Metrics" dataKey="A" stroke="#a855f7" fill="#a855f7" fillOpacity={0.6} />
                                                <Tooltip />
                                            </RadarChart>
                                        </ResponsiveContainer>
                                    </div>
                                    
                                    {/* Grid Metrik Angka */}
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                                        {Object.entries(selectedCandidate.metrics).map(([key, val]) => (
                                            <div key={key} className="bg-slate-900 p-3 rounded-lg text-center border border-slate-700">
                                                <div className="text-xs text-slate-500 uppercase">{key}</div>
                                                <div className="text-xl font-mono text-purple-400">{typeof val === 'number' ? val.toFixed(3) : val}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SboxAnalyzer />);
    </script>
</body>
</html>
